let currentTabId=null,currentVideoId=null,currentUrl=null,isLoading=!1,latestVideoData=null,refreshInterval=null,navigationCheckInterval=null;const RETRY_CONFIG={MAX_RETRIES:15,INITIAL_DELAY:1e3,MAX_DELAY:5e3,BACKOFF_MULTIPLIER:1.3,PERIODIC_REFRESH_INTERVAL:2e3,NAVIGATION_CHECK_INTERVAL:1e3};let popupRetryCount=0,popupRetryTimer=null;function initializePopup(tab){currentTabId=tab.id,currentUrl=tab.url,currentVideoId=extractVideoId(tab.url),console.log("Popup initialized:",{tabId:currentTabId,url:currentUrl,videoId:currentVideoId}),loadVideoData(!0),setupPeriodicRefresh(),setupNavigationDetection(),setTimeout(()=>{cleanup()},12e4)}function loadVideoData(showLoading=!0,forceRefresh=!1){!isLoading||forceRefresh?(popupRetryTimer&&(clearTimeout(popupRetryTimer),popupRetryTimer=null),chrome.tabs.query({active:!0,currentWindow:!0},tabs=>{if(!tabs||0===tabs.length)return void showError("No active tab found.");const tab=tabs[0],newUrl=tab.url,newVideoId=extractVideoId(newUrl);currentUrl!==newUrl?(console.log("Navigation detected:",{old:currentUrl,new:newUrl,oldVideoId:currentVideoId,newVideoId:newVideoId}),currentUrl=newUrl,currentVideoId=newVideoId,currentTabId=tab.id,popupRetryCount=0):currentTabId!==tab.id&&(currentTabId=tab.id,currentUrl=newUrl,currentVideoId=newVideoId,popupRetryCount=0),showLoading&&0===popupRetryCount&&showLoadingState(),isLoading=!0,requestVideoDetection(currentTabId),wakeServiceWorkerAndGetData(currentTabId,newVideoId)})):console.log("Already loading, skipping duplicate request")}function requestVideoDetection(tabId){chrome.tabs.sendMessage(tabId,{action:"triggerVideoExtraction",reason:"popup-request"},response=>{chrome.runtime.lastError?console.log("Could not request video detection:",chrome.runtime.lastError.message):console.log("Video detection requested:",response)})}function wakeServiceWorkerAndGetData(tabId,expectedVideoId){chrome.runtime.sendMessage({action:"ping"},pingResponse=>{chrome.runtime.sendMessage({action:"getVideoData",tabId:tabId},response=>{if(isLoading=!1,chrome.runtime.lastError)return void handleError(chrome.runtime.lastError.message);if(!response)return void handleError("No response from background script");const videoData=response.videoData||{urls:[]};latestVideoData=videoData,!(videoData.urls&&videoData.urls.length>0&&hasVideosForCurrentPage(videoData,expectedVideoId))&&popupRetryCount<RETRY_CONFIG.MAX_RETRIES?handleRetry(expectedVideoId):(popupRetryCount=0,displayVideosWithTitle(videoData,tabId))})})}function hasVideosForCurrentPage(videoData,expectedVideoId){if(!videoData.urls||0===videoData.urls.length)return!1;if(!expectedVideoId){const recentThreshold=Date.now()-3e4;return videoData.urls.some(v=>v.timestamp&&v.timestamp>recentThreshold)}const normalizedExpectedId=String(expectedVideoId);return videoData.urls.some(v=>!!v.videoId&&String(v.videoId)===normalizedExpectedId)}function handleRetry(expectedVideoId){popupRetryCount++;const delay=Math.min(RETRY_CONFIG.INITIAL_DELAY*Math.pow(RETRY_CONFIG.BACKOFF_MULTIPLIER,popupRetryCount-1),RETRY_CONFIG.MAX_DELAY),container=document.getElementById("videoList");container&&(container.innerHTML=`\n      <div class="no-videos">\n        <div class="no-videos-icon">‚è≥</div>\n        <h3>Detecting Videos...</h3>\n        <p>No videos detected yet. Retrying... (${popupRetryCount}/${RETRY_CONFIG.MAX_RETRIES})</p>\n        <p>This may take a moment on slow connections.</p>\n        <p style="font-size: 11px; color: #666; margin-top: 8px;">\n          ${popupRetryCount<=3?"‚è±Ô∏è Waiting for page to load...":popupRetryCount<=8?"üîÑ Checking for videos...":"üåê Slow connection detected, please wait..."}\n        </p>\n      </div>\n    `),popupRetryTimer=setTimeout(()=>{requestVideoDetection(currentTabId),loadVideoData(!1,!0)},delay)}function displayVideosWithTitle(videoData,tabId){!videoData.videoTitle||"Dailymotion Video"===videoData.videoTitle||videoData.videoTitle.toLowerCase().includes("dailymotion video player")?chrome.tabs.get(tabId,tab=>{if(!chrome.runtime.lastError&&tab&&tab.title){const title=cleanVideoTitle(tab.title);title&&(videoData.videoTitle=title)}displayVideos(videoData)}):displayVideos(videoData)}function showLoadingState(){const container=document.getElementById("videoList");container&&(container.innerHTML='\n      <div class="no-videos">\n        <div class="no-videos-icon">‚è≥</div>\n        <h3>Loading Video Data...</h3>\n        <p>Please wait while we detect video URLs.</p>\n        <p>If the page is still loading, this may take a moment.</p>\n      </div>\n    ')}function handleError(errorMsg){isLoading=!1;const container=document.getElementById("videoList");if(container){const isConnectionError=errorMsg.includes("Could not establish connection")||errorMsg.includes("Receiving end does not exist");container.innerHTML=`\n      <div class="no-videos">\n        <div class="no-videos-icon">‚ö†Ô∏è</div>\n        <h3>${isConnectionError?"Service Worker Not Running":"Connection Error"}</h3>\n        <p>${isConnectionError?"The extension service worker is not running.":`Error: ${errorMsg}`}</p>\n        <p>Please:</p>\n        <ol>\n          <li>Reload the extension (chrome://extensions ‚Üí Reload)</li>\n          <li>Refresh this Dailymotion page</li>\n          <li>Click the refresh button below</li>\n        </ol>\n        <button class="refresh-btn" onclick="window.loadVideoData(true, true)">üîÑ Refresh</button>\n      </div>\n    `}popupRetryCount=0}function showError(message){const container=document.getElementById("videoList");container&&(container.innerHTML=`\n      <div class="no-videos">\n        <div class="no-videos-icon">‚ö†Ô∏è</div>\n        <h3>Error</h3>\n        <p>${message}</p>\n        <button class="refresh-btn" onclick="window.loadVideoData(true, true)">üîÑ Retry</button>\n      </div>\n    `)}function setupPeriodicRefresh(){refreshInterval&&clearInterval(refreshInterval),refreshInterval=setInterval(()=>{const container=document.getElementById("videoList");container&&container.querySelector(".no-videos")&&popupRetryCount<RETRY_CONFIG.MAX_RETRIES&&!isLoading&&loadVideoData(!1,!0)},RETRY_CONFIG.PERIODIC_REFRESH_INTERVAL)}function setupNavigationDetection(){navigationCheckInterval&&clearInterval(navigationCheckInterval),navigationCheckInterval=setInterval(()=>{chrome.tabs.query({active:!0,currentWindow:!0},tabs=>{if(tabs&&tabs.length>0&&tabs[0]){const newUrl=tabs[0].url,newVideoId=extractVideoId(newUrl);newUrl===currentUrl&&newVideoId===currentVideoId||(console.log("Navigation detected in popup:",{oldUrl:currentUrl,newUrl:newUrl,oldVideoId:currentVideoId,newVideoId:newVideoId}),popupRetryCount=0,loadVideoData(!0,!0))}})},RETRY_CONFIG.NAVIGATION_CHECK_INTERVAL)}function cleanup(){refreshInterval&&(clearInterval(refreshInterval),refreshInterval=null),navigationCheckInterval&&(clearInterval(navigationCheckInterval),navigationCheckInterval=null),popupRetryTimer&&(clearTimeout(popupRetryTimer),popupRetryTimer=null)}function displayVideos(videoData){const container=document.getElementById("videoList");if(!videoData||!videoData.urls||0===videoData.urls.length)return void(container.innerHTML='\n      <div class="no-videos">\n        <div class="no-videos-icon">üé¨</div>\n        <h3>No Videos Detected</h3>\n        <p>No video URLs detected yet.</p>\n        <p>Play the video on Dailymotion and wait a moment for detection.</p>\n      </div>\n    ');const reliableUrls=videoData.urls.filter(v=>!v.type.includes("mp4-full")&&("config"!==v.type&&!v.url.includes("master.json")&&!v.url.includes("config")&&(!("hls-master"===v.type||v.type&&v.type.includes("hls-master"))&&((!v.type||!isHLS(v.type)||null!==extractQuality(v.type,v.url))&&!isFileTooSmall(v.fileSize)))));if(0===reliableUrls.length)return void(container.innerHTML='\n      <div class="no-videos">\n        <div class="no-videos-icon">üé¨</div>\n        <h3>No Videos Detected</h3>\n        <p>No video URLs detected yet.</p>\n        <p>Play the video on Dailymotion and wait a moment for detection.</p>\n      </div>\n    ');const defaultVideoTitle=videoData.videoTitle||"Dailymotion Video",videosByPage={};reliableUrls.forEach(video=>{const videoId=video.videoId||"unknown";videosByPage[videoId]||(videosByPage[videoId]=[]),videosByPage[videoId].push(video)});let currentPageVideos=[],allOtherPagesVideos=[];const currentPageSet=new Set,veryRecentThreshold=Date.now()-3e4;if(currentVideoId){const normalizedCurrentVideoId=String(currentVideoId);if(reliableUrls.forEach(v=>{(v.videoId?String(v.videoId):null)===normalizedCurrentVideoId&&currentPageSet.add(v.url)}),0===currentPageSet.size){const veryRecentVideos=reliableUrls.filter(v=>v.fromNetworkRequest&&v.timestamp&&v.timestamp>veryRecentThreshold).sort((a,b)=>(b.timestamp||0)-(a.timestamp||0));if(veryRecentVideos.length>0){const mostRecent=veryRecentVideos[0];currentPageSet.add(mostRecent.url),mostRecent.videoId?reliableUrls.forEach(v=>{v.videoId===mostRecent.videoId&&currentPageSet.add(v.url)}):veryRecentVideos.slice(0,10).forEach(v=>{currentPageSet.add(v.url)}),console.log("No videos matched currentVideoId, using very recent videos as fallback")}}reliableUrls.filter(v=>v.active).forEach(v=>currentPageSet.add(v.url))}else if(reliableUrls.filter(v=>v.active).forEach(v=>currentPageSet.add(v.url)),0===currentPageSet.size){const recentNetworkVideos=reliableUrls.filter(v=>v.fromNetworkRequest&&v.timestamp).sort((a,b)=>(b.timestamp||0)-(a.timestamp||0));if(recentNetworkVideos.length>0){const mostRecent=recentNetworkVideos[0];currentPageSet.add(mostRecent.url),mostRecent.videoId&&reliableUrls.forEach(v=>{v.videoId===mostRecent.videoId&&currentPageSet.add(v.url)})}}currentPageVideos=reliableUrls.filter(v=>currentPageSet.has(v.url)),allOtherPagesVideos=reliableUrls.filter(v=>!currentPageSet.has(v.url)),container.innerHTML="";const renderSectionHeader=(title,isFirst=!1)=>{const header=document.createElement("div");header.className="section-header",header.style.cssText=`\n      margin-top: ${isFirst?"0":"24px"};\n      margin-bottom: 16px;\n      padding: 12px 16px;\n      background: #f8f9fa;\n      border-left: 4px solid #667eea;\n      border-radius: 6px;\n    `,header.innerHTML=`\n      <div style="font-size: 13px; font-weight: 600; color: #333;">\n        ${title}\n      </div>\n    `,container.appendChild(header)},renderVideos=videos=>{if(0===videos.length)return;const groupedVideos=(videos=>{const grouped={};return videos.forEach(video=>{const key=(video.videoId?String(video.videoId):null)||video.videoTitle||"unknown";grouped[key]||(grouped[key]=[]),grouped[key].push(video)}),grouped})(videos);Object.keys(groupedVideos).forEach(videoKey=>{const videoGroup=groupedVideos[videoKey],sortedQualities=videoGroup.sort((a,b)=>{const aIsMP4=isMP4(a.type),bIsMP4=isMP4(b.type);if(aIsMP4&&!bIsMP4)return-1;if(!aIsMP4&&bIsMP4)return 1;const qualityA=extractQuality(a.type,a.url)||0;return(extractQuality(b.type,b.url)||0)-qualityA}),uniqueQualities=new Map;sortedQualities.forEach(video=>{if(!video)return;const quality=extractQuality(video.type,video.url);if(!quality){const isMP4Type=isMP4(video.type),isHLSType=isHLS(video.type),fallbackKey="unknown-"+(isMP4Type?"MP4":isHLSType?"HLS":"OTHER");return void(uniqueQualities.has(fallbackKey)||uniqueQualities.set(fallbackKey,video))}const isMP4Type=isMP4(video.type),isHLSType=isHLS(video.type),qualityKey=`${quality}p-${isMP4Type?"MP4":isHLSType?"HLS":"OTHER"}`;uniqueQualities.has(qualityKey)||uniqueQualities.set(qualityKey,video)});const deduplicatedQualities=Array.from(uniqueQualities.values()).sort((a,b)=>{if(!a||!b)return 0;const aIsMP4=isMP4(a.type),bIsMP4=isMP4(b.type);if(aIsMP4&&!bIsMP4)return-1;if(!aIsMP4&&bIsMP4)return 1;const qualityA=extractQuality(a.type,a.url)||0;return(extractQuality(b.type,b.url)||0)-qualityA});if(0===deduplicatedQualities.length){if(console.warn("No videos after deduplication for videoKey:",videoKey,"- using original videoGroup as fallback"),0===videoGroup.length)return;deduplicatedQualities.push(...videoGroup.slice(0,1))}const firstVideo=deduplicatedQualities[0];if(!firstVideo)return void console.warn("firstVideo is undefined for videoKey:",videoKey);let displayTitle=null;const videoIdForLookup=firstVideo.videoId?String(firstVideo.videoId):null,isCurrentPageVideo=currentVideoId&&videoIdForLookup&&String(currentVideoId)===videoIdForLookup;if(videoIdForLookup&&videoData.videoIds){const titleFromMap=videoData.videoIds[videoIdForLookup]?.title||videoData.videoIds[firstVideo.videoId]?.title;if(titleFromMap){const lowerTitle=titleFromMap.toLowerCase();"Dailymotion Video"===titleFromMap||lowerTitle.includes("dailymotion video player")||lowerTitle.match(/^(dailymotion|video|dailymotion video player|video player)$/i)||(displayTitle=titleFromMap)}}if(!displayTitle){const videoWithTitle=deduplicatedQualities.find(v=>{if(!v||!v.videoTitle)return!1;const lowerTitle=v.videoTitle.toLowerCase();return"Dailymotion Video"!==v.videoTitle&&!lowerTitle.includes("dailymotion video player")&&!lowerTitle.match(/^(dailymotion|video|dailymotion video player|video player)$/i)});if(videoWithTitle)displayTitle=videoWithTitle.videoTitle;else if(firstVideo&&firstVideo.videoTitle){const lowerTitle=firstVideo.videoTitle.toLowerCase();"Dailymotion Video"===firstVideo.videoTitle||lowerTitle.includes("dailymotion video player")||lowerTitle.match(/^(dailymotion|video|dailymotion video player|video player)$/i)||(displayTitle=firstVideo.videoTitle)}}displayTitle||(displayTitle=isCurrentPageVideo?defaultVideoTitle:"Dailymotion Video");const item=document.createElement("div");item.className="video-item";let qualityMenuItems="";deduplicatedQualities.forEach((video,idx)=>{if(!video||!video.url)return;const qualityLabel=formatQualityLabel(video),videoIndex=videoData.urls.findIndex(v=>v.url===video.url);qualityMenuItems+=`<div class="quality-menu-item" data-index="${idx}" data-url="${video.url}" data-video-index="${videoIndex>=0?videoIndex:""}">${qualityLabel}</div>`});const defaultVideo=deduplicatedQualities[0];if(!defaultVideo)return void console.warn("defaultVideo is undefined for videoKey:",videoKey);formatTypeLabel(defaultVideo.type);const defaultShortUrl=defaultVideo.url.length>80?defaultVideo.url.substring(0,80)+"...":defaultVideo.url,defaultQualityLabel=formatQualityLabel(defaultVideo);item.innerHTML=`\n        <div class="video-header">\n          <div>\n            <div class="video-title">${displayTitle}</div>\n          </div>\n        </div>\n        <div class="video-url" title="${defaultVideo.url}">${defaultShortUrl}</div>\n      <div class="button-group">\n          <div class="download-button-group">\n            <button class="download-btn" data-url="${defaultVideo.url}" data-index="${videoData.urls.findIndex(v=>v.url===defaultVideo.url)}" data-quality-label="${defaultQualityLabel}" data-display-title="${displayTitle.replace(/"/g,"&quot;")}">\n              Download\n            </button>\n            <button class="download-dropdown-btn" aria-label="Select quality">\n              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n              </svg>\n        </button>\n            <div class="quality-dropdown-menu">\n              ${qualityMenuItems}\n            </div>\n          </div>\n          <button class="copy-btn" data-url="${defaultVideo.url}">\n            Copy\n        </button>\n      </div>\n    `,container.appendChild(item);const videoUrlDiv=item.querySelector(".video-url"),downloadBtn=item.querySelector(".download-btn"),copyBtn=item.querySelector(".copy-btn"),dropdownBtn=item.querySelector(".download-dropdown-btn"),qualityMenu=item.querySelector(".quality-dropdown-menu");dropdownBtn&&qualityMenu&&dropdownBtn.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),document.querySelectorAll(".quality-dropdown-menu").forEach(menu=>{if(menu!==qualityMenu){menu.classList.remove("show");const otherItem=menu.closest(".video-item");otherItem&&otherItem.classList.remove("dropdown-open")}}),qualityMenu.classList.contains("show")?(qualityMenu.classList.remove("show"),item.classList.remove("dropdown-open")):(qualityMenu.classList.add("show"),item.classList.add("dropdown-open"))}),document.addEventListener("click",e=>{item.contains(e.target)||(qualityMenu.classList.remove("show"),item.classList.remove("dropdown-open"))}),qualityMenu.querySelectorAll(".quality-menu-item").forEach(menuItem=>{menuItem.addEventListener("click",e=>{e.stopPropagation();const selectedUrl=menuItem.dataset.url;if(!selectedUrl)return void console.error("No URL found in quality menu item:",menuItem);let selectedVideo=videoData.urls.find(v=>v.url===selectedUrl);if(!selectedVideo){const selectedIndex=parseInt(menuItem.dataset.index);if(selectedIndex>=0&&selectedIndex<deduplicatedQualities.length){const fallbackVideo=deduplicatedQualities[selectedIndex];fallbackVideo&&fallbackVideo.url===selectedUrl&&(selectedVideo=videoData.urls.find(v=>v.url===selectedUrl))}if(!selectedVideo)return void console.error("Could not find video for URL:",selectedUrl)}const qualityLabel=formatQualityLabel(selectedVideo),shortUrl=selectedVideo.url.length>80?selectedVideo.url.substring(0,80)+"...":selectedVideo.url;videoUrlDiv.textContent=shortUrl,videoUrlDiv.title=selectedVideo.url,downloadBtn.dataset.url=selectedVideo.url;const videoIndex=videoData.urls.findIndex(v=>v.url===selectedVideo.url);downloadBtn.dataset.index=videoIndex>=0?videoIndex.toString():"",downloadBtn.dataset.qualityLabel=qualityLabel,copyBtn.dataset.url=selectedVideo.url,qualityMenu.querySelectorAll(".quality-menu-item").forEach(item=>{item.classList.remove("selected")}),menuItem.classList.add("selected"),qualityMenu.classList.remove("show"),item.classList.remove("dropdown-open")})}),qualityMenu.querySelectorAll(".quality-menu-item").length>0&&qualityMenu.querySelectorAll(".quality-menu-item")[0].classList.add("selected")})};currentPageVideos.length>0&&(renderSectionHeader("Current Page",!0),renderVideos(currentPageVideos)),allOtherPagesVideos.length>0&&(renderSectionHeader("Other Pages",!1),renderVideos(allOtherPagesVideos)),0===Object.keys(videosByPage).length&&reliableUrls.length>0&&renderVideos(reliableUrls),document.querySelectorAll(".download-btn").forEach(btn=>{btn.addEventListener("click",e=>{const url=e.target.dataset.url,index=e.target.dataset.index,videoItem=videoData.urls.find(v=>v.url===url)||(void 0!==index?videoData.urls[index]:null);if(videoItem){const videoTitle=e.target.dataset.displayTitle||videoItem.videoTitle||videoData.videoTitle||"Dailymotion Video",qualityLabel=e.target.dataset.qualityLabel||"",videoIndex=videoData.urls.findIndex(v=>v.url===url);downloadVideo(url,videoIndex>=0?videoIndex:0,videoItem.type,videoTitle,qualityLabel)}else console.error("Video item not found for URL:",url)})}),document.querySelectorAll(".copy-btn").forEach(btn=>{btn.addEventListener("click",e=>{copyToClipboard(e.target.dataset.url),e.target.textContent="Copied!",setTimeout(()=>{e.target.textContent="Copy"},2e3)})}),document.querySelectorAll(".parse-btn").forEach(btn=>{btn.addEventListener("click",e=>{parseConfigFile(e.target.dataset.url),e.target.textContent="‚è≥ Parsing...",e.target.disabled=!0})})}function parseConfigFile(configUrl){chrome.runtime.sendMessage({action:"parseConfig",url:configUrl,tabId:currentTabId},response=>{response&&response.success?(console.log("Config parsed, reloading video list..."),setTimeout(()=>{loadVideoData(!0,!0)},1e3)):alert("Failed to parse config file. Check console for details.")})}function extractQuality(type,url=""){let match=type.match(/(\d+)p/i);if(match)return parseInt(match[1]);if(match=type.match(/-(\d+)$/),match)return parseInt(match[1]);if(match=type.match(/-(\d+)p?$/i),match)return parseInt(match[1]);if(url){if(match=url.match(/\/(\d+)p/i),match)return parseInt(match[1]);if(match=url.match(/\/(\d{3,4})(?:\/|$)/),match){const num=parseInt(match[1]);if(num>=240&&num<=4320&&num%10==0)return num}}return null}function formatTypeLabel(type){return type.includes("mp4")?type.toUpperCase():type.includes("m3u8")||type.includes("hls")?"HLS Stream":type.toUpperCase()}function downloadVideo(url,index,type,videoTitle="Dailymotion Video",qualityLabel=""){const sanitizedTitle=(name=>{let sanitized=name.replace(/[\/\\:\*\?"<>\|]/g,"");return sanitized=sanitized.trim().replace(/^\.+|\.+$/g,""),sanitized.length>200&&(sanitized=sanitized.substring(0,200)),sanitized||"Dailymotion Video"})(videoTitle),extension=getExtension(url);let filename;if(qualityLabel&&qualityLabel.trim()){const qualityMatch=qualityLabel.match(/(\d+p)/i);filename=`${sanitizedTitle} - ${qualityMatch?qualityMatch[1]:qualityLabel.split(" ")[0]}.${extension}`}else filename=`${sanitizedTitle}.${extension}`;chrome.runtime.sendMessage({action:"download",url:url,filename:filename,type:type,qualityLabel:qualityLabel,tabId:currentTabId,videoId:latestVideoData&&latestVideoData.urls&&latestVideoData.urls[index]&&latestVideoData.urls[index].videoId?latestVideoData.urls[index].videoId:void 0},downloadResponse=>{if(downloadResponse&&downloadResponse.success)console.log("Download started");else if(downloadResponse&&downloadResponse.error){const errorMsg=downloadResponse.error;errorMsg.includes("already being downloaded")?showNotification("‚è≥ Download in Progress","This file is already being downloaded. Please wait for the current download to complete.","warning"):showNotification("Download Failed",errorMsg,"error")}})}function showNotification(title,message,type="info"){const notificationArea=document.getElementById("notificationArea");if(!notificationArea)return void console.error("Notification area not found");notificationArea.innerHTML="",notificationArea.style.display="block";const notificationEl=document.createElement("div");notificationEl.className=`notification ${type}`,notificationEl.innerHTML=`\n    <div class="notification-title">${title}</div>\n    <div class="notification-message">${message}</div>\n  `,notificationArea.appendChild(notificationEl),setTimeout(()=>{notificationEl.style.transform="translateY(0)",notificationEl.style.opacity="1"},10),setTimeout(()=>{notificationEl.style.transform="translateY(-100%)",notificationEl.style.opacity="0",setTimeout(()=>{notificationEl.parentNode&&notificationEl.parentNode.removeChild(notificationEl),0===notificationArea.children.length&&(notificationArea.style.display="none")},300)},5e3)}function getExtension(url){return url.includes(".mp4")?"mp4":url.includes(".m3u8")?"m3u8":"video"}function copyToClipboard(text){navigator.clipboard.writeText(text).then(()=>{console.log("Copied to clipboard")}).catch(err=>{console.error("Failed to copy:",err)})}chrome.tabs.query({active:!0,currentWindow:!0},tabs=>{tabs&&tabs.length>0&&tabs[0]?initializePopup(tabs[0]):showError("No active tab found. Please open a Dailymotion video page.")}),window.loadVideoData=loadVideoData;
//# sourceMappingURL=popup.js.map